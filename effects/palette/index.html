<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport"
	      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Document</title>
	<link rel="stylesheet" href="./style.css">
</head>
<body>
	<canvas id="main" ></canvas>
	<div id="actions" class="actions">
		<button id="eraser">eraser</button>
		<button id="pen">pen</button>
	</div>
</body>
</html>

<script>
    var main = document.getElementById('main');
    var context = main.getContext('2d')
    autoSetCanvas(main);

    listenToUser(main);

    var eraserEnabled = false;
    eraser.onclick = function (e) {
        eraserEnabled = true;
        actions.className = 'actions showPen'
    }
    pen.onclick = function (e) {
        eraserEnabled = false;
        actions.className = 'actions '
    }

    /*==============*/
    function listenToUser(canvas) {

        var penDown = false;
        var lastPoint = {x:undefined,y:undefined}
        if(document.body.ontouchstart !== undefined){
			canvas.ontouchstart = function (e) {

                var x = e.touches[0].clientX;
                var y = e.touches[0].clientY;
                penDown = true;
                if(!eraserEnabled){
                    lastPoint = {x:x, y:y}
                }else {
                    context.clearRect(x-5,y-5,10,10)
                }
            }
            canvas.ontouchmove = function (e) {
                var x = e.touches[0].clientX;
                var y = e.touches[0].clientY;
                var newPoint = {x:x,y:y};
                if(!penDown){return}
                if(eraserEnabled){
                    context.clearRect(x-5,y-5,10,10)
                }else{
                    drawLine(lastPoint.x,lastPoint.y,newPoint.x,newPoint.y)
                }
                lastPoint = newPoint //新旧交换
            }
            canvas.ontouchend = function (e) {
                penDown = false
            }
        }else {
            canvas.onmousedown =function (e) {
                var x = e.clientX;
                var y = e.clientY;
                penDown = true;
                if(!eraserEnabled){
                    lastPoint = {x:x, y:y}
                }else {
                    context.clearRect(x-5,y-5,10,10)
                }
            }
            canvas.onmousemove = function (e) {
                var x = e.clientX;
                var y = e.clientY;
//                var newPoint = {x:x,y:y};
                if(!penDown){return}
                if(eraserEnabled){
                    context.clearRect(x-5,y-5,10,10)
                }else{
                    var newPoint = {x:x,y:y};
                    drawLine(lastPoint.x,lastPoint.y,newPoint.x,newPoint.y)
                    lastPoint = newPoint //新旧交换
                }
//                lastPoint = newPoint //新旧交换
            }
            canvas.onmouseup  =function (e) {
                penDown = false
            }
        }


    }
    function drawLine(startX,startY,endX,endY) {
        context.moveTo(startX,startY)
        context.lineWidth =3;
        context.lineTo(endX,endY)
        context.stroke()
        context.closePath()
    }
    function autoSetCanvas(canvas) {
        setCanvasSize();

        window.onresize = function () {
            setCanvasSize();
        }

        function setCanvasSize() {
            var pageWidth = document.documentElement.clientWidth;
            var pageHeight = document.documentElement.clientHeight;
            canvas.width = pageWidth;
            canvas.height = pageHeight;
        }
    }

/*    function drawCircle(x,y,radius) {
        context.beginPath()
        context.arc(x,y,radius,0,Math.PI*2)
        context.stroke()
    }*/

</script>